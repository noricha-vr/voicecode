---
name: "fix-voice"
description: "音声認識の誤変換報告時に、ユーザー辞書または同音異義語リストへ登録する"
---

# 音声認識誤変換の修正登録

<background_information>
VoiceCodeプロジェクトでは、音声認識の誤変換を2種類の方法で修正できる:

1. **ユーザー辞書** (`~/.voicecode/dictionary.txt`)
   - カタカナ読み → 英語表記の変換
   - TSV形式: `読み<TAB>英語`
   - 例: `クロードコード	Claude Code`

2. **同音異義語** (`postprocessor.py` のシステムプロンプト)
   - 日本語の同音異義語の誤変換を修正
   - `</examples>` タグの直前に `<example>` を追加
</background_information>

## 使用するタイミング

<trigger_conditions>
- ユーザーが音声認識の誤変換を報告した時
- 「辞書に追加」「同音異義語に追加」「誤変換を登録」などのキーワード
- 「○○が△△と認識される」という報告
</trigger_conditions>

<instructions>

## 実行手順

### 1. 情報収集

ユーザーに以下を確認（まだ分かっていない場合）:
- **誤った状態**: 音声認識でどう認識されたか
- **正しい状態**: 本来どう認識されるべきか

### 2. 登録先の自動判定

以下の基準で登録先を決定:

| 条件 | 登録先 | 理由 |
|------|--------|------|
| 誤=カタカナのみ AND 正=英数字/記号を含む | ユーザー辞書 | プログラミング用語の変換 |
| それ以外（漢字の誤変換など） | 同音異義語 | 文脈依存の修正 |

### 3. implementer に委譲して登録

#### ユーザー辞書の場合

`~/.voicecode/dictionary.txt` に追記:
```
{読み}<TAB>{英語}
```

**注意**:
- ファイルが存在しない場合は新規作成
- TSV形式（タブ区切り）

#### 同音異義語の場合

`postprocessor.py` の `</examples>` 直前に以下を追加:

```xml
<example name="同音異義語修正（{正しい表記}/{誤った表記}）">
<input>{誤った状態を含む例文}</input>
<output>{正しい状態を含む例文}</output>
<explanation>{なぜこの修正が正しいかの説明}</explanation>
</example>
```

### 4. 確認

- ユーザーに登録内容を報告
- 必要に応じてテストを実行

</instructions>

## チェックリスト

- [ ] 誤った状態と正しい状態を確認したか
- [ ] 登録先を正しく判定したか
- [ ] 既存の辞書/例に重複がないか確認したか
- [ ] 登録内容をユーザーに報告したか

## 例

### ユーザー辞書への登録例

```
ユーザー: 「ピップ」が「pip」にならない
→ ~/.voicecode/dictionary.txt に追記: ピップ	pip
```

### 同音異義語への登録例

```
ユーザー: 「以上」が「異常」になる
→ postprocessor.py に example を追加
```
